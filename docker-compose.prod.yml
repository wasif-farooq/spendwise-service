version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    command: node -r tsconfig-paths/register dist/processes/api-gateway/index.js
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - NODE_ENV=production
      # Database
      - DB_HOST=postgres
      - DB_PORT=5432
      - POSTGRES_DB=${DB_NAME:-antigravity}
      - POSTGRES_USER=${DB_USER:-antigravity}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-password}
      # Redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      # Kafka
      - KAFKA_BROKERS=kafka:29092
      - KAFKA_CLIENT_ID=spendwise-api
      - KAFKA_GROUP_ID=spendwise-group
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - antigravity-network

  worker:
    build:
      context: .
      dockerfile: Dockerfile
    command: node -r tsconfig-paths/register dist/processes/worker/index.js
    environment:
      - NODE_ENV=production
      # Database
      - DB_HOST=postgres
      - DB_PORT=5432
      - POSTGRES_DB=${DB_NAME:-antigravity}
      - POSTGRES_USER=${DB_USER:-antigravity}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-password}
      # Redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      # Kafka
      - KAFKA_BROKERS=kafka:29092
      - KAFKA_CLIENT_ID=spendwise-worker
      - KAFKA_GROUP_ID=spendwise-worker-group
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - antigravity-network


